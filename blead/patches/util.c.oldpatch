***************
*** 2647,2650 ****
--- 2647,2666 ----
  #endif
  
+ #if defined(OEMVS)
+   #if (__CHARSET_LIB == 1)
+   static int chgfdccsid(int fd, unsigned short ccsid) 
+   {
+     attrib_t attr;
+     memset(&attr, 0, sizeof(attr));
+     attr.att_filetagchg = 1;
+     attr.att_filetag.ft_ccsid = ccsid;
+     if (ccsid != FT_BINARY) {
+       attr.att_filetag.ft_txtflag = 1;
+     }
+     return __fchattr(fd, &attr, sizeof(attr));
+   }
+   #endif
+ #endif
+ 
  PerlIO *
  Perl_my_popen_list(pTHX_ const char *mode, int n, SV **args)
***************
*** 2694,2697 ****
--- 2710,2719 ----
          if (did_pipes)
              PerlLIO_close(pp[0]);
+ #if defined(OEMVS)
+   #if (__CHARSET_LIB == 1)
+         chgfdccsid(p[THIS], 819);
+         chgfdccsid(p[THAT], 819);
+   #endif
+ #endif
          /* Now dup our end of _the_ pipe to right position */
          if (p[THIS] != (*mode == 'r')) {
***************
*** 2769,2774 ****
--- 2791,2809 ----
      if (did_pipes)
           PerlLIO_close(pp[0]);
+ #if defined(OEMVS)
+   #if (__CHARSET_LIB == 1)
+     PerlIO* io = PerlIO_fdopen(p[This], mode);
+     if (io) {
+       chgfdccsid(p[This], 819);
+     }
+     return io;
+   #else
      return PerlIO_fdopen(p[This], mode);
+   #endif
  #else
+     return PerlIO_fdopen(p[This], mode);
+ #endif
+ 
+ #else
  #  if defined(OS2)	/* Same, without fork()ing and all extra overhead... */
      return my_syspopen4(aTHX_ NULL, mode, n, args);
***************
*** 2836,2839 ****
--- 2871,2880 ----
          if (did_pipes)
              PerlLIO_close(pp[0]);
+ #if defined(OEMVS)
+   #if (__CHARSET_LIB == 1)
+         chgfdccsid(p[THIS], 819);
+         chgfdccsid(p[THAT], 819);
+   #endif
+ #endif
          if (p[THIS] != (*mode == 'r')) {
              PerlLIO_dup2(p[THIS], *mode == 'r');
***************
*** 2922,2926 ****
--- 2963,2979 ----
      if (did_pipes)
           PerlLIO_close(pp[0]);
+ #if defined(OEMVS)
+   #if (__CHARSET_LIB == 1)
+     PerlIO* io = PerlIO_fdopen(p[This],	mode);
+     if (io) {
+       chgfdccsid(p[This], 819);
+     }
+     return io;
+   #else
      return PerlIO_fdopen(p[This], mode);
+   #endif
+ #else
+     return PerlIO_fdopen(p[This], mode);
+ #endif
  }
  #elif defined(__LIBCATAMOUNT__)
